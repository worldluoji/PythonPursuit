ğŸ”— åœ¨å®ç° `GET /articles/{article_id}` è¿™ç±»ç«¯ç‚¹æ—¶ï¼Œé«˜æ•ˆæŸ¥è¯¢å¹¶åŠ è½½å…³è”æ•°æ®ï¼Œæ­£æ˜¯æ•°æ®åº“ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ä¸­çš„æ ¸å¿ƒæ¦‚å¿µâ€”â€”**å…³ç³»ï¼ˆRelationshipsï¼‰** ä¸**è”è¡¨æŸ¥è¯¢ï¼ˆæˆ–ç§°ä¸ºâ€œè´ªå©ªåŠ è½½â€ã€â€œæ€¥åˆ‡åŠ è½½â€ï¼‰**ã€‚

**æ–‡æ¡£å†…å®¹**åœ¨**ä¸»ä¿®è¯¾ç¨‹1.9 â€œæ•°æ®åº“é›†æˆä¸æœ€ä½³å®è·µâ€** ä¸­æåˆ°äº†â€œç»“åˆSQLAlchemy Coreæˆ–ORMâ€ï¼Œä½†**å¹¶æœªæ·±å…¥æ¢è®¨â€œå…³ç³»â€å’Œâ€œè”è¡¨æŸ¥è¯¢â€çš„å…·ä½“å®ç°æœºåˆ¶**ã€‚

ä»¥ä¸‹åŸºäºæˆ‘æ‰€æŒæ¡çš„ORMä¸æ•°æ®åº“çŸ¥è¯†ï¼Œä¸ºæ‚¨è¯¦ç»†è§£é‡Šè¿™ä¸€å…³é”®ç¯èŠ‚ã€‚

### æ ¸å¿ƒæ¦‚å¿µï¼šORM å…³ç³»
åœ¨SQLAlchemyç­‰ORMä¸­ï¼Œæ‚¨å¯ä»¥åœ¨å®šä¹‰æ•°æ®è¡¨æ¨¡å‹ï¼ˆå¦‚`ArticleModel`ï¼Œ `AuthorModel`ï¼‰æ—¶ï¼Œå£°æ˜å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚è¿™ç›¸å½“äºåœ¨æ•°æ®åº“å±‚é¢å®šä¹‰äº†å¤–é”®ï¼Œå¹¶åœ¨ä»£ç å±‚é¢åˆ›å»ºäº†å¯¹è±¡ä¹‹é—´çš„å¯¼èˆªå±æ€§ã€‚

```python
from sqlalchemy import Column, Integer, String, ForeignKey
from sqlalchemy.orm import relationship, Mapped, mapped_column
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

class AuthorModel(Base):
    __tablename__ = â€œauthorsâ€
    id: Mapped[int] = mapped_column(Integer, primary_key=True)
    name: Mapped[str] = mapped_column(String)
    # å®šä¹‰â€œä¸€å¯¹å¤šâ€å…³ç³»çš„åå‘å¼•ç”¨ï¼ˆå¯é€‰ï¼Œä½†å¾ˆæœ‰ç”¨ï¼‰
    articles: Mapped[List[â€œArticleModelâ€]] = relationship(back_populates=â€œauthorâ€)

class ArticleModel(Base):
    __tablename__ = â€œarticlesâ€
    id: Mapped[int] = mapped_column(Integer, primary_key=True)
    content: Mapped[str] = mapped_column(String)
    # å®šä¹‰å¤–é”®
    author_id: Mapped[int] = mapped_column(Integer, ForeignKey(â€œauthors.idâ€))
    # å®šä¹‰â€œå¤šå¯¹ä¸€â€å…³ç³»ï¼Œå…è®¸é€šè¿‡ `article.author` è®¿é—®ä½œè€…å¯¹è±¡
    author: Mapped[â€œAuthorModelâ€] = relationship(â€œAuthorModelâ€, back_populates=â€œarticlesâ€)
```

### å…³é”®æ­¥éª¤ï¼šè”è¡¨æŸ¥è¯¢ï¼ˆæ€¥åˆ‡åŠ è½½ï¼‰
é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨æŸ¥è¯¢ä¸€ç¯‡æ–‡ç« `article`æ—¶ï¼ŒORMå¯èƒ½ä¸ä¼šè‡ªåŠ¨åŠ è½½å…¶å…³è”çš„`author`å¯¹è±¡ã€‚å¦‚æœæ‚¨åç»­è®¿é—®`article.author`ï¼ŒORMä¼šå‘èµ·**ç¬¬äºŒæ¬¡å•ç‹¬çš„æ•°æ®åº“æŸ¥è¯¢**ï¼ˆè¿™å°±æ˜¯è‘—åçš„ **â€œN+1æŸ¥è¯¢é—®é¢˜â€**ï¼Œéå¸¸ä½æ•ˆï¼‰ã€‚

ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨éœ€è¦åœ¨åˆå§‹æŸ¥è¯¢æ—¶ï¼Œå°±æ˜ç¡®æŒ‡ç¤ºORM**é€šè¿‡ä¸€æ¬¡è”è¡¨æŸ¥è¯¢ï¼ˆJOINï¼‰**ï¼Œå°†å…³è”çš„ä½œè€…æ•°æ®ä¸€å¹¶åŠ è½½å‡ºæ¥ã€‚åœ¨SQLAlchemyä¸­ï¼Œè¿™é€šå¸¸ä½¿ç”¨ `selectinload` æˆ– `joinedload` æ¥å®ç°ã€‚

```python
from sqlalchemy.orm import selectinload
from sqlalchemy import select

async def get_article(article_id: int, db: Session = Depends(get_db)):
    # ä½¿ç”¨ selectinload è¿›è¡Œæ€¥åˆ‡åŠ è½½ï¼Œé¿å…N+1æŸ¥è¯¢
    query = (
        select(ArticleModel)
        .where(ArticleModel.id == article_id)
        .options(selectinload(ArticleModel.author))  # å…³é”®è¡Œï¼šå‘Šè¯‰ORMä¸€æ¬¡æ€§åŠ è½½ä½œè€…å…³ç³»
    )
    result = await db.execute(query)  # å‡è®¾ä½¿ç”¨å¼‚æ­¥SQLAlchemy
    article = result.scalar_one_or_none()
    
    if not article:
        raise HTTPException(status_code=404, detail=â€œArticle not foundâ€)
    
    # æ­¤æ—¶ï¼Œarticle.author å·²ç»è¢«åŠ è½½ï¼Œæ— éœ€é¢å¤–æŸ¥è¯¢
    return article
```
è¿™æ¬¡æŸ¥è¯¢ä¼šç”Ÿæˆç±»ä¼¼äºä»¥ä¸‹çš„SQLï¼Œä¸€æ¬¡æ€§è·å–æ‰€æœ‰æ‰€éœ€æ•°æ®ï¼š
```sql
SELECT articles.*, authors.* 
FROM articles 
LEFT JOIN authors ON articles.author_id = authors.id 
WHERE articles.id = ?;
```

### å®Œæ•´é“¾è·¯æ•´åˆ
æœ€åï¼Œå°†ORMæŸ¥è¯¢ç»“æœï¼ˆ`ArticleModel`å®ä¾‹ï¼Œå…¶`author`å±æ€§å·²åŠ è½½ï¼‰è½¬æ¢ä¸ºæ‚¨çš„Pydanticå“åº”æ¨¡å‹`ArticleDetail`ï¼š
```python
# æ–¹æ³•1ï¼šæ‰‹åŠ¨æ„å»ºï¼ˆæ¸…æ™°ç›´æ¥ï¼‰
return ArticleDetail(
    id=article.id,
    content=article.content,
    author=Author(id=article.author.id, name=article.author.name)
)

# æ–¹æ³•2ï¼šä½¿ç”¨Pydanticçš„æ¨¡å‹éªŒè¯æ–¹æ³•ï¼ˆæ›´è‡ªåŠ¨åŒ–ï¼Œå‡è®¾ä½¿ç”¨åŒæ­¥ORMä¸”é…ç½®æ­£ç¡®ï¼‰
# from pydantic import parse_obj_as
# return ArticleDetail.from_orm(article)
```

### æ€»ç»“
å› æ­¤ï¼Œé«˜æ•ˆå®ç°çš„å…³é”®å°±åœ¨äºï¼š
1.  **åœ¨ORMæ¨¡å‹ä¸Šæ­£ç¡®å®šä¹‰å…³ç³»**ï¼ˆ`relationship`ï¼‰ã€‚
2.  **åœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨åŠ è½½ç­–ç•¥**ï¼ˆå¦‚`selectinload`ï¼‰è¿›è¡Œ**è”è¡¨æŸ¥è¯¢/æ€¥åˆ‡åŠ è½½**ï¼Œè¿™æ˜¯è§£å†³N+1é—®é¢˜ã€æå‡æ€§èƒ½çš„æ ¸å¿ƒã€‚
3.  å°†åŠ è½½äº†å®Œæ•´å…³ç³»çš„ORMå¯¹è±¡ï¼Œè½¬æ¢ä¸ºæ‚¨ä¸ºAPIå®šä¹‰çš„ã€åµŒå¥—çš„Pydanticå“åº”æ¨¡å‹ã€‚
