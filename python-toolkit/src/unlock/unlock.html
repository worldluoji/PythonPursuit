<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜²é”å±å·¥å…· - Chromeç‰ˆæœ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }
        
        h1 {
            margin-bottom: 1rem;
            font-size: 2.5rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .description {
            margin-bottom: 2rem;
            line-height: 1.6;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .status-panel {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 10px;
            min-width: 150px;
            margin: 0.5rem;
        }
        
        .status-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }
        
        .active {
            color: #4CAF50;
        }
        
        .inactive {
            color: #F44336;
        }
        
        .controls {
            margin: 2rem 0;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            margin: 0 0.5rem;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .stop-btn {
            background: #F44336;
        }
        
        .stop-btn:hover {
            background: #d32f2f;
        }
        
        .fullscreen-btn {
            background: #2196F3;
        }
        
        .fullscreen-btn:hover {
            background: #0b7dda;
        }
        
        .activity-indicator {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin: 2rem 0;
            overflow: hidden;
        }
        
        .activity-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 2rem;
            text-align: left;
        }
        
        .info-box h3 {
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 0.5rem;
        }
        
        .info-box ul {
            padding-left: 1.5rem;
        }
        
        .info-box li {
            margin-bottom: 0.5rem;
        }
        
        .footer {
            margin-top: 2rem;
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem;
            border-radius: 5px;
            display: none;
            z-index: 1000;
        }
        
        .progress-bar {
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            width: 100%;
            background: #4CAF50;
            animation: progress 60s linear;
        }
        
        @keyframes progress {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        .settings {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .settings h3 {
            margin-bottom: 1rem;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .setting-item label {
            margin-right: 1rem;
        }
        
        .setting-item input {
            padding: 0.5rem;
            border-radius: 5px;
            border: none;
            width: 80px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ é˜²é”å±å·¥å…· (Chromeç‰ˆæœ¬)</h1>
        <p class="description">æ­¤é¡µé¢é€šè¿‡æ¨¡æ‹ŸæŒ‰é”®æ´»åŠ¨é˜²æ­¢ç”µè„‘è¿›å…¥ä¼‘çœ æˆ–é”å±çŠ¶æ€ã€‚ä¿æŒé¡µé¢æ‰“å¼€å³å¯ï¼Œä¸å½±å“æ‚¨çš„æ­£å¸¸æ“ä½œã€‚</p>
        
        <div class="status-panel">
            <div class="status-item">
                <div>çŠ¶æ€</div>
                <div id="status" class="status-value inactive">æœªæ¿€æ´»</div>
            </div>
            <div class="status-item">
                <div>è¿è¡Œæ—¶é—´</div>
                <div id="runtime" class="status-value">00:00:00</div>
            </div>
            <div class="status-item">
                <div>æ´»åŠ¨è®¡æ•°</div>
                <div id="activityCount" class="status-value">0</div>
            </div>
            <div class="status-item">
                <div>ä¸‹æ¬¡æ´»åŠ¨</div>
                <div id="nextActivity" class="status-value">60ç§’</div>
            </div>
        </div>
        
        <div class="activity-indicator">
            <div id="activityBar" class="activity-bar"></div>
        </div>
        
        <div class="controls">
            <button id="startBtn">å¼€å§‹é˜²é”å±</button>
            <button id="stopBtn" class="stop-btn" disabled>åœæ­¢é˜²é”å±</button>
            <button id="fullscreenBtn" class="fullscreen-btn">è¿›å…¥å…¨å±</button>
        </div>
        
        <div class="settings">
            <h3>âš™ï¸ è®¾ç½®</h3>
            <div class="setting-item">
                <label for="intervalInput">æ´»åŠ¨é—´éš” (ç§’):</label>
                <input type="number" id="intervalInput" min="10" max="300" value="60">
            </div>
            <div class="setting-item">
                <label for="keySelect">æ¨¡æ‹ŸæŒ‰é”®:</label>
                <select id="keySelect">
                    <option value="F15">F15 (æ¨è)</option>
                    <option value="F12">F12</option>
                    <option value="F5">F5</option>
                    <option value="Space">ç©ºæ ¼é”®</option>
                </select>
            </div>
        </div>
        
        <div class="info-box">
            <h3>ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li>ç‚¹å‡»"å¼€å§‹é˜²é”å±"æŒ‰é’®å¯åŠ¨é˜²é”å±åŠŸèƒ½</li>
                <li>é¡µé¢å°†å®šæœŸæ¨¡æ‹ŸæŒ‰é”®äº‹ä»¶ï¼Œé˜²æ­¢ç³»ç»Ÿé”å±</li>
                <li>è¿›å…¥å…¨å±æ¨¡å¼å¯æé«˜é˜²é”å±æ•ˆæœ</li>
                <li>è¦åœæ­¢é˜²é”å±ï¼Œç‚¹å‡»"åœæ­¢é˜²é”å±"æŒ‰é’®æˆ–ç›´æ¥å…³é—­é¡µé¢</li>
                <li>æ³¨æ„ï¼šæŸäº›å…¬å¸ç­–ç•¥å¯èƒ½è¦†ç›–æ­¤åŠŸèƒ½</li>
            </ul>
        </div>
        
        <div class="footer">
            <p>æ³¨æ„ï¼šæ­¤å·¥å…·ä»…ç”¨äºé˜²æ­¢ç³»ç»Ÿè‡ªåŠ¨é”å±ï¼Œè¯·éµå®ˆæ‚¨æ‰€åœ¨ç»„ç»‡çš„è®¡ç®—æœºä½¿ç”¨æ”¿ç­–ã€‚</p>
        </div>
    </div>

    <div id="notification" class="notification">
        <div>é˜²é”å±æ´»åŠ¨å·²è§¦å‘</div>
        <div class="progress-bar">
            <div class="progress" id="notificationProgress"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let isActive = false;
        let activityInterval;
        let startTime;
        let activityCount = 0;
        let runtimeInterval;
        let nextActivityTimeout;
        let intervalDuration = 60000; // é»˜è®¤60ç§’
        
        // DOMå…ƒç´ 
        const statusElement = document.getElementById('status');
        const runtimeElement = document.getElementById('runtime');
        const activityCountElement = document.getElementById('activityCount');
        const activityBar = document.getElementById('activityBar');
        const nextActivityElement = document.getElementById('nextActivity');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const notification = document.getElementById('notification');
        const notificationProgress = document.getElementById('notificationProgress');
        const intervalInput = document.getElementById('intervalInput');
        const keySelect = document.getElementById('keySelect');
        
        // å¼€å§‹é˜²é”å±
        function startPreventingSleep() {
            if (isActive) return;
            
            isActive = true;
            activityCount = 0;
            startTime = new Date();
            intervalDuration = parseInt(intervalInput.value) * 1000;
            
            // æ›´æ–°UIçŠ¶æ€
            statusElement.textContent = 'è¿è¡Œä¸­';
            statusElement.className = 'status-value active';
            startBtn.disabled = true;
            stopBtn.disabled = false;
            activityBar.style.width = '100%';
            
            // è®¾ç½®å®šæ—¶æ´»åŠ¨
            scheduleNextActivity();
            
            // æ›´æ–°è¿è¡Œæ—¶é—´
            runtimeInterval = setInterval(updateRuntime, 1000);
            updateRuntime();
            
            // æ›´æ–°æ´»åŠ¨è®¡æ•°
            updateActivityCount();
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification('é˜²é”å±åŠŸèƒ½å·²å¯åŠ¨');
        }
        
        // åœæ­¢é˜²é”å±
        function stopPreventingSleep() {
            if (!isActive) return;
            
            isActive = false;
            
            // æ¸…é™¤å®šæ—¶å™¨
            clearInterval(activityInterval);
            clearInterval(runtimeInterval);
            clearTimeout(nextActivityTimeout);
            
            // æ›´æ–°UIçŠ¶æ€
            statusElement.textContent = 'å·²åœæ­¢';
            statusElement.className = 'status-value inactive';
            startBtn.disabled = false;
            stopBtn.disabled = true;
            activityBar.style.width = '0%';
            nextActivityElement.textContent = '--';
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification('é˜²é”å±åŠŸèƒ½å·²åœæ­¢');
        }
        
        // å®‰æ’ä¸‹ä¸€æ¬¡æ´»åŠ¨
        function scheduleNextActivity() {
            if (!isActive) return;
            
            // æ¸…é™¤ç°æœ‰å®šæ—¶å™¨
            clearTimeout(nextActivityTimeout);
            
            // è®¡ç®—å‰©ä½™æ—¶é—´
            const now = new Date().getTime();
            const nextActivityTime = now + intervalDuration;
            
            // æ›´æ–°ä¸‹æ¬¡æ´»åŠ¨æ˜¾ç¤º
            updateNextActivityDisplay(intervalDuration);
            
            // è®¾ç½®ä¸‹ä¸€æ¬¡æ´»åŠ¨
            nextActivityTimeout = setTimeout(() => {
                simulateActivity();
                scheduleNextActivity(); // å®‰æ’ä¸‹ä¸€æ¬¡æ´»åŠ¨
            }, intervalDuration);
        }
        
        // æ›´æ–°ä¸‹æ¬¡æ´»åŠ¨æ˜¾ç¤º
        function updateNextActivityDisplay(duration) {
            const seconds = Math.floor(duration / 1000);
            nextActivityElement.textContent = `${seconds}ç§’`;
            
            // é‡ç½®è¿›åº¦æ¡åŠ¨ç”»
            notificationProgress.style.animation = 'none';
            setTimeout(() => {
                notificationProgress.style.animation = `progress ${seconds}s linear`;
            }, 10);
        }
        
        // æ¨¡æ‹Ÿç”¨æˆ·æ´»åŠ¨
        function simulateActivity() {
            if (!isActive) return;
            
            const key = keySelect.value;
            
            try {
                // åˆ›å»ºé”®ç›˜äº‹ä»¶
                const keyDownEvent = new KeyboardEvent('keydown', {
                    key: key,
                    code: key,
                    keyCode: getKeyCode(key),
                    which: getKeyCode(key),
                    bubbles: true,
                    cancelable: true
                });
                
                const keyUpEvent = new KeyboardEvent('keyup', {
                    key: key,
                    code: key,
                    keyCode: getKeyCode(key),
                    which: getKeyCode(key),
                    bubbles: true,
                    cancelable: true
                });
                
                // æ´¾å‘äº‹ä»¶
                document.dispatchEvent(keyDownEvent);
                setTimeout(() => {
                    document.dispatchEvent(keyUpEvent);
                    
                    // æ›´æ–°æ´»åŠ¨è®¡æ•°
                    activityCount++;
                    updateActivityCount();
                    
                    // æ˜¾ç¤ºé€šçŸ¥
                    showNotification(`å·²æ¨¡æ‹ŸæŒ‰é”®: ${key}`);
                }, 50);
            } catch (error) {
                console.error('æ¨¡æ‹ŸæŒ‰é”®å¤±è´¥:', error);
                // å¤‡ç”¨æ–¹æ¡ˆï¼šå°è¯•ä½¿ç”¨æ›´ç®€å•çš„æ–¹æ³•
                try {
                    // åˆ›å»ºä¸€ä¸ªéšè—çš„è¾“å…¥æ¡†å¹¶èšç„¦
                    const input = document.createElement('input');
                    input.style.position = 'fixed';
                    input.style.top = '-100px';
                    input.style.left = '-100px';
                    document.body.appendChild(input);
                    input.focus();
                    
                    setTimeout(() => {
                        document.body.removeChild(input);
                        document.body.focus();
                        
                        // æ›´æ–°æ´»åŠ¨è®¡æ•°
                        activityCount++;
                        updateActivityCount();
                        
                        // æ˜¾ç¤ºé€šçŸ¥
                        showNotification('å·²æ¨¡æ‹Ÿç„¦ç‚¹å˜åŒ–');
                    }, 100);
                } catch (fallbackError) {
                    console.error('å¤‡ç”¨æ–¹æ¡ˆä¹Ÿå¤±è´¥:', fallbackError);
                }
            }
        }
        
        // è·å–é”®ç 
        function getKeyCode(key) {
            const keyCodes = {
                'F15': 135,
                'F12': 123,
                'F5': 116,
                'Space': 32
            };
            return keyCodes[key] || 135; // é»˜è®¤F15
        }
        
        // æ›´æ–°è¿è¡Œæ—¶é—´
        function updateRuntime() {
            if (!isActive) return;
            
            const now = new Date();
            const diff = now - startTime;
            
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            
            runtimeElement.textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // æ›´æ–°æ´»åŠ¨è®¡æ•°
        function updateActivityCount() {
            activityCountElement.textContent = activityCount;
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            if (!isActive) return;
            
            notification.querySelector('div').textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // è¿›å…¥å…¨å±
        function enterFullscreen() {
            const elem = document.documentElement;
            
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.mozRequestFullScreen) { /* Firefox */
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE/Edge */
                elem.msRequestFullscreen();
            }
            
            showNotification('å·²è¿›å…¥å…¨å±æ¨¡å¼');
        }
        
        // äº‹ä»¶ç›‘å¬
        startBtn.addEventListener('click', startPreventingSleep);
        stopBtn.addEventListener('click', stopPreventingSleep);
        fullscreenBtn.addEventListener('click', enterFullscreen);
        
        // é—´éš”è®¾ç½®å˜åŒ–æ—¶æ›´æ–°
        intervalInput.addEventListener('change', function() {
            const value = parseInt(this.value);
            if (value < 10) this.value = 10;
            if (value > 300) this.value = 300;
            
            if (isActive) {
                intervalDuration = parseInt(this.value) * 1000;
                scheduleNextActivity();
            }
        });
        
        // é¡µé¢å¸è½½æ—¶åœæ­¢é˜²é”å±
        window.addEventListener('beforeunload', stopPreventingSleep);
        
        // åˆå§‹çŠ¶æ€
        updateRuntime();
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl+Shift+S å¼€å§‹/åœæ­¢
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                if (isActive) {
                    stopPreventingSleep();
                } else {
                    startPreventingSleep();
                }
            }
            
            // Ctrl+Shift+F å…¨å±
            if (e.ctrlKey && e.shiftKey && e.key === 'F') {
                e.preventDefault();
                enterFullscreen();
            }
        });
    </script>
</body>
</html>